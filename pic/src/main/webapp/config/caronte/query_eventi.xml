<?xml version = "1.0" encoding = "ISO-8859-1"?>
<QUERIES>
    <QUERY_GROUP id="DATI"/>

    <QUERY_GROUP id="FILTRI"/>

    <QUERY_GROUP id="MODULI_CONSENSO"/>
    
				<!-- PRIVACY_EVENTO IS NULL OR EXTRACTVALUE(PRIVACY_EVENTO, '//dse.oscuramento') = 'R' -->      
				<!-- PRIVACY_EVENTO IS NULL OR EXTRACTVALUE(PRIVACY_EVENTO, '//dse.oscuramento') = 'A' -->
                                              
    <QUERY_GROUP id="WORKLIST">
    
        <QUERY id="EVENTO">
            <SQL>
                SELECT 
                	NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, TTR.DESCR TIPO_RICOVERO
					, CDC.DESCR REPARTO
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//DSE.alimentazione') DSE_INSERIMENTO
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//DSE.oscuramento') DSE_OSCURAMENTO
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//paziente-non-capace') PAZIENTE_NON_CAPACE
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//confidentiality-code') CONF_CODE
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE IN ('PS','ORD','URG','DH','DS','ODS') AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.NUM_NOSOLOGICO = :num_nosologico 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
            </SQL>
        </QUERY>
           
        <QUERY id="EVENTI_DSE">
            <SQL>
                SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//DSE.alimentazione') DSE_INSERIMENTO
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//DSE.oscuramento') DSE_OSCURAMENTO
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//paziente-non-capace') PAZIENTE_NON_CAPACE
					, EXTRACTVALUE(NP.PRIVACY_EVENTO, '//confidentiality-code') CONF_CODE
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE IN ('PS','ORD','URG','DH','DS','ODS') AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
                {#ORDER#} 
            </SQL>
        </QUERY>
        
        <QUERY id="RICERCA_ACCESSI_PS_INESPRESSI">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE = 'PS' AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
				AND (
					PCK_PRIVACY.IS_INESPRESSO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>
        <QUERY id="RICERCA_ACCESSI_PS_ATTIVATI">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE = 'PS' AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
				AND (
					PCK_PRIVACY.IS_ATTIVATO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>
        <QUERY id="RICERCA_ACCESSI_PS_OSCURATI">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE = 'PS' AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
				AND (
					PCK_PRIVACY.IS_OSCURATO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>
        
        <QUERY id="RICERCA_CARTELLE_AMB_INESPRESSE">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE = 'AMB' AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
				AND (
					PCK_PRIVACY.IS_INESPRESSO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>        
        <QUERY id="RICERCA_CARTELLE_AMB_ATTIVATE">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE = 'AMB' AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
				AND (
					PCK_PRIVACY.IS_ATTIVATO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>
        <QUERY id="RICERCA_CARTELLE_AMB_OSCURATE">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON TTR.CODICE = 'AMB' AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N'
				AND (
					PCK_PRIVACY.IS_OSCURATO(NP.NUM_NOSOLOGICO) = 1
				) 
				{#ORDER#}
            </SQL>
        </QUERY>

        <QUERY id="RICERCA_RICOVERI_INESPRESSI">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON ttr.CODICE IN ('ORD','URG','DH','DS','ODS') AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N' 
				AND (
					PCK_PRIVACY.IS_INESPRESSO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>                             
        <QUERY id="RICERCA_RICOVERI_ATTIVATI">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON ttr.CODICE IN ('ORD','URG','DH','DS','ODS') AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N' 
				AND (
					PCK_PRIVACY.IS_ATTIVATO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>
        <QUERY id="RICERCA_RICOVERI_OSCURATI">
            <SQL>
				SELECT 
					NP.IDEN_ANAG
					, NP.IDEN IDEN_EVENTO
					, NP.NUM_NOSOLOGICO NUM_PRATICA
					, NP.DATA_RICOVERO DATA_INIZIO
					, NP.ORA_RICOVERO ORA_INIZIO
					, NP.DATA_FINE_RICOVERO DATA_FINE
					, NP.ORA_FINE_RICOVERO ORA_FINE
					, NP.DIMESSO DIMESSO
					, CDC.DESCR REPARTO
				FROM NOSOLOGICI_PAZIENTE NP
				JOIN TAB_TIPO_RICOVERO TTR ON ttr.CODICE IN ('ORD','URG','DH','DS','ODS') AND TTR.IDEN = NP.IDEN_TIPO_RICOVERO
				JOIN CENTRI_DI_COSTO CDC ON CDC.COD_CDC = NP.COD_CDC
				WHERE NP.IDEN_ANAG = TO_NUMBER(:anagrafica) 
				AND NP.ACCESSO = 0 
				AND NP.DELETED = 'N' 
				AND (
					PCK_PRIVACY.IS_OSCURATO(NP.NUM_NOSOLOGICO) = 1
				)
				{#ORDER#}
            </SQL>
        </QUERY>                     
    </QUERY_GROUP>

    <QUERY_GROUP id="AUTOCOMPLETE"/>

</QUERIES>
